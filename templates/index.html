{% extends "base.html" %}

{% block title %}Inicio{% endblock %}

{% block content %}
  <h2 class="mb-4">Listado de Clientes</h2>

  <div class="mb-3">
    <a class="btn btn-primary" href="{{ url_for('nuevo_cliente') }}">‚ûï Nuevo Cliente</a>
    <a class="btn btn-secondary" href="{{ url_for('liquidacion') }}">üìä Ver Liquidaci√≥n</a>
  </div>

  <p><strong>Hoy:</strong> {{ hoy.strftime("%d/%m/%Y") }}</p>

  {% if clientes %}
    <table class="table table-bordered table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>Orden</th>
          <th>C√≥digo</th>
          <th>Fecha</th>
          <th>Nombre</th>
          <th>Monto</th>
          <th>Abono</th>
          <th>Saldo</th>
          <th>Eliminar</th>
        </tr>
      </thead>
      <tbody>
        {% for c in clientes %}
          <tr class="{{ estado_class(c) }}">
            <!-- Orden -->
            <td style="width:110px;">
              <form action="{{ url_for('actualizar_orden', cliente_id=c.id) }}" method="post" class="d-flex">
                <input type="number" name="orden" value="{{ c.orden }}" 
                       class="form-control no-arrows" 
                       style="font-size:1.2rem; padding:8px; text-align:center;" />
                <button type="submit" 
                        class="btn btn-outline-primary ms-1" 
                        style="font-size:1rem; padding:8px 12px;">‚úî</button>
              </form>
            </td>

            <!-- C√≥digo -->
            <td>{{ c.codigo }}</td>

            <!-- Fecha -->
            <td>{{ c.fecha_creacion.strftime("%d/%m/%Y") }}</td>

            <!-- Nombre -->
            <td>{{ c.nombre }}</td>

            <!-- Monto -->
            <td>{{ "%.2f"|format(c.monto) }}</td>

            <!-- Abono -->
            <td style="width:140px;">
              <form action="{{ url_for('abonar', cliente_id=c.id) }}" method="post" class="d-flex">
                <input type="number" step="0.01" name="monto_abono" value="0"
                       class="form-control no-arrows abono-input" 
                       style="font-size:1.2rem; padding:8px; text-align:right;" />
                <button type="submit" 
                        class="btn btn-success ms-1" 
                        style="font-size:1rem; padding:8px 12px;">üíµ</button>
              </form>
            </td>

            <!-- Saldo -->
            <td>{{ "%.2f"|format(c.saldo) }}</td>

            <!-- Eliminar cliente -->
            <td>
              <form action="{{ url_for('eliminar_cliente', cliente_id=c.id) }}" 
                    method="post" 
                    onsubmit="return confirm('¬øSeguro que deseas eliminar este cliente?');">
                <button type="submit" 
                        class="btn btn-danger" 
                        style="font-size:1rem; padding:8px 12px;">‚ùå</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="alert alert-info">No hay clientes registrados todav√≠a.</div>
  {% endif %}

  <!-- Script para poner la celda de abono en verde -->
  <script>
    document.querySelectorAll('.abono-input').forEach(function(input) {
      input.addEventListener('input', function() {
        if (parseFloat(this.value) > 0) {
          this.style.backgroundColor = '#d4edda'; // verde suave
        } else {
          this.style.backgroundColor = '';
        }
      });
    });
  </script>

  <!-- CSS para quitar flechitas de los inputs number -->
  <style>
    input.no-arrows::-webkit-outer-spin-button,
    input.no-arrows::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input.no-arrows[type=number] {
      -moz-appearance: textfield;
    }
  </style>
{% endblock %}
